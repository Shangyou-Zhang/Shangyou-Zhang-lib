# `printf` 

`printf` 是 C 语言中用于格式化输出的标准库函数，定义在 `<stdio.h>` 头文件中。它可以将数据以特定的格式输出到标准输出设备（通常是屏幕）。通过 `printf`，我们可以打印字符串、数值、字符、浮点数等各种数据类型，并根据需要指定输出格式。

## 1. **基本语法**

```c
#include <stdio.h>

int printf(const char *format, ...);
```

- **`format`**：格式字符串，指定输出的格式，包含普通字符和格式控制符（占位符）。
- **`...`**：表示可变参数列表，表示传入的变量数量和类型由格式字符串决定。

## 2. **格式控制符**

格式控制符用于指定输出的格式，包括数据类型、宽度、精度、对齐方式等。格式控制符以 `%` 开头，后面跟着一组可选的标志、宽度、精度、长度修饰符和转换说明符。

### 2.1 **基本格式控制符**

|转换说明符|描述|示例输出|
|---|---|---|
|`%d`|打印带符号的十进制整数|`123`|
|`%i`|打印带符号的十进制整数|`123`|
|`%u`|打印无符号十进制整数|`123`|
|`%o`|打印无符号八进制整数|`173`|
|`%x`|打印无符号十六进制整数|`7b`|
|`%X`|打印无符号十六进制整数（大写）|`7B`|
|`%f`|打印浮点数（小数点格式）|`123.456`|
|`%e`|打印浮点数（科学计数法）|`1.234560e+02`|
|`%g`|打印浮点数（自动选择`%f`或`%e`）|`123.456`|
|`%c`|打印单个字符|`A`|
|`%s`|打印字符串|`Hello`|
|`%p`|打印指针地址|`0x7fffbfdf8a00`|
|`%%`|打印一个 `%` 符号|`%`|

### 2.2 **修饰符**

修饰符可以修改输出的宽度、精度、对齐方式等。常见的修饰符有：

#### 2.2.1 **宽度**

指定输出字段的最小宽度。如果输出的内容小于指定宽度，则会进行填充（默认是空格）。如果实际输出内容大于指定宽度，则输出内容会完全显示。

```c
printf("%5d", 123);  // 输出：  123（宽度为5，数字前面填充空格）
```

#### 2.2.2 **精度**

精度用于浮点数和字符串的输出。对于浮点数，精度表示小数点后的位数；对于字符串，精度表示打印的字符个数。

```c
printf("%.2f", 123.456);  // 输出：123.46（保留两位小数）
printf("%.3s", "Hello");  // 输出：Hel（只打印前三个字符）
```

#### 2.2.3 **对齐方式**

默认情况下，输出是右对齐的。可以通过 `-` 标志实现左对齐：

```c
printf("%-5d", 123);  // 输出：123  （宽度为5，数字左对齐，后面填充空格）
```

#### 2.2.4 **填充字符**

可以通过指定一个填充字符，来控制输出的空白部分使用何种字符，默认是空格。如果使用 `0` 作为填充字符，数字会被零填充。

```c
printf("%05d", 123);  // 输出：00123（宽度为5，数字前面填充零）
```

#### 2.2.5 **长度修饰符**

长度修饰符用于指定数据类型的大小，常见的有：

- **`h`**：表示 `short` 类型。
- **`l`**：表示 `long` 类型。
- **`ll`**：表示 `long long` 类型。
- **`L`**：表示 `long double` 类型。

例如：

```c
printf("%hd", (short)123);  // 输出：123（打印short类型）
printf("%ld", 123456789L);  // 输出：123456789（打印long类型）
```

---

## 3. **特殊用途的格式控制符**

### 3.1 **打印指针**

通过 `%p` 可以打印指针的地址。指针会被转换为一个十六进制的地址表示形式。

```c
int a = 10;
printf("%p", &a);  // 输出指针地址
```

### 3.2 **打印多个变量**

`printf` 支持多个变量的输出，只需要在格式字符串中使用相应数量的格式控制符。

```c
int a = 10;
float b = 3.14;
char c = 'A';
printf("a = %d, b = %.2f, c = %c", a, b, c);  
// 输出：a = 10, b = 3.14, c = A
```

### 3.3 **打印百分号（`%`）**

如果需要打印百分号字符，可以使用 `%%` 来表示。

```c
printf("Success rate: 90%%");  // 输出：Success rate: 90%
```

### 3.4 **自动选择浮点数格式**

`%g` 是一种根据数值大小自动选择最适合格式（`%f` 或 `%e`）的格式控制符。

```c
printf("%g", 123456.789);  // 输出：123457
printf("%g", 0.000123456);  // 输出：1.23456e-04
```

---

## 4. **常见问题及注意事项**

### 4.1 **格式不匹配**

如果传入的变量类型和格式控制符不匹配，会导致未定义行为（undefined behavior）。例如：

```c
int x = 123;
printf("%f", x);  // 错误，x 是整数，应使用 %d
```

### 4.2 **`printf`的返回值**

`printf` 的返回值是成功输出的字符数（不包括终止符 `\0`），如果发生错误，则返回负值。

```c
int ret = printf("Hello, world!");
if (ret < 0) {
    // 处理错误
}
```

### 4.3 **精度问题**

浮点数的精度有限制，可能会导致输出不精确。例如，浮点数输出时可能会有舍入误差。

```c
printf("%.10f", 1.123456789012345);  // 输出：1.1234567890
```

### 4.4 **防止输出溢出**

需要确保格式化字符串的宽度足够容纳输出数据，避免因宽度不够导致溢出。对于非常大的数值或长字符串，应动态调整宽度或精度。

---

## 5. **`printf` 函数的使用技巧**

### 5.1 **打印变量的二进制表示**

C标准库并没有直接提供打印二进制的功能，但可以利用其他格式控制符间接实现：

```c
int n = 10;
for (int i = sizeof(n) * 8 - 1; i >= 0; i--) {
    printf("%d", (n >> i) & 1);
}
printf("\n");
```

### 5.2 **打印多个格式化输出**

可以一次性输出多个不同格式的数据，适用于日志输出或调试信息：

```c
int x = 5;
float y = 3.14;
char z = 'A';
printf("x = %d, y = %.2f, z = %c\n", x, y, z);
```

### 5.3 **打印时间和日期**

使用 `time.h` 库中的时间函数，结合 `printf` 输出时间和日期：

```c
#include <time.h>
time_t t = time(NULL);
struct tm *tm_info = localtime(&t);
printf("Current time: %s", asctime(tm_info));  // 输出当前时间
```

---
